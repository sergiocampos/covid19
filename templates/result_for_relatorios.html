{% load static %}
{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
	<title>Relatório de Registro - Casos COVID19</title>
	<link rel="stylesheet" href="">

	<script language="JavaScript" type="text/javascript" src="/static/js/cidades-estados-1.4-utf8.js"></script>


</head>
<body>

	<div class="container" style="border: 2px solid #cccccc; border-radius: 10px">
		<div class="jumbotron">
			<h1>SES COVID - Registro - Casos COVID19</h1>
			<p></p>
		</div>

		<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
		  <ul class="navbar-nav">
		    <li class="nav-item">
		      <a class="nav-link" href="/">Principal</a>
		    </li>
		    <li class="nav-item">
		      <a class="nav-link" href="/search_estabelecimento/">Registrar Caso</a>
		    </li>
		    <!--
		    <li class="nav-item">
		      <a class="nav-link" href="/registro_covid/">Registrar Caso</a>
		    </li>
		-->
		    <li class="nav-item">
		      <a class="nav-link" href="#"></a>
		    </li>
		    <li class="nav-item">
		      <a class="nav-link" href="/search_register/">Localizar</a>
		    </li>
		    <li class="nav-item">
		      <a class="nav-link active" href="/gerar_relatorios/">Relatórios</a>
		    </li>
		    <li>
		    	<a class="nav-link" href="/accounts/logout">Sair</a>
		    </li>
		  </ul>
		</nav><br>
		
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4" style="background-color:;">
					<div style="position: relative; left: 0; top: 20%; width: 100%; text-align: center;">
						<img src="https://docs.google.com/uc?id=1g14C98IyGkVYPNNkoLk20rGYVikptzcC" alt="" style=" background-color: ;width: 70%">
					</div>
				</div>

	      		<div class="col-sm-4" style="">
	      			<div class="col" style="text-align: center;">
	      				<p>GOVERNO DO ESTADO DA PARAÍBA</p>
	      				<p>SECRETARIA DE ESTADO DA SAÚDE</p>
	      				<p></p>
	      				<p><h7><b>Registro de Casos - Perfil {{user.first_name}} - Usuário: <i>{{user}}</i></b></h7></p>
	      			</div>
	      		</div>
	      		<div class="col-sm-4" style="background-color:;">
	      			<div style="position: relative; left: 0; top: 30%; width: 100%; text-align: center;">
	      				<img src="https://docs.google.com/uc?id=11gNpuLZuHBRHHiSFZxcSp5CGlJla1PEw" alt="" style="background-color: ;width: 70%">
	      			</div>
	      		</div>
	      	</div>
	    <br>
		</div>
		<hr />

		<div class="row">
			<div class="col-sm-5"></div>
			<div class="col-sm-3"></div>
			<div class="col-sm-4"></div>
		</div>

		<div class="row">
			<div class="col-sm-5"></div>
			<div class="col-sm-3"><b class="btn btn-secondary btn-sm">Informe data de início e fim</b></div>
			<div class="col-sm-4"></div>
		</div><br />

	<div class="container mt-3">
	  	<form enctype="multipart/form-data" action="submit" method="POST">{% csrf_token %}
	  		<div class="container">
	  			<div class="row">
	  				<div class="col-sm-1"></div>
	  				<div class="col-sm-5">Início
	  					<div class="form-check-inline">
							<input type="date" class="form-control form-control-sm" id="" placeholder="" name="data_inicio" value="" required>
					    </div>
	  				</div>
	  				<div class="col-sm-1"></div>
	  				<div class="col-sm-5">Fim
	  					<div class="form-check-inline">
							<input type="date" class="form-control form-control-sm" id="" placeholder="" name="data_fim" value="" required>
					    </div>
	  				</div>
	  			</div>
	  		</div>
	  		<br />

	  		<div class="container-fluid" style="text-align: center;">
				<a href="/gerar_relatorios/" class="btn btn-info btn-sm" style="background-color: #0066ff">Nova pesquisa</a>  
	    	</div><br />
	  	</form>
	</div>

	<hr />


	<table class="table table-hover" style="font-size: 55%" id="tb_covid1" cellspacing="0" cellpadding="0">

	    <thead>
	      <tr>
	      	<th>Protocolo</th>
	      	<th>Registro CERN</th>
	      	<th>Nome</th>
	        <th>Idade</th>
	        <th>Sexo</th>
	        <th>Regulacao</th>
	        <th>Municipio de Residencia</th>
	        <th>Estabelecimento de Origem</th>
	        <th>Estabelecimento Referencia Covid</th>
	        <th>Municipio do Estabelecimento</th>
	        <th>Perfil</th>
	        <th>Data</th>
	        <th>Comorbidades</th>
	        <th>Nivel de Atencao</th>
	        <th>Tipo de Teste</th>
	        <th>Teste Covid</th>
	      </tr>
	    </thead>
	    <tbody>
	    	{% for v in values %}
	      <tr>
	      	<td>SESCOVID{{v.codigo_sescovid}}</td>
	      	<td>{{v.codigo_registro_completo}}</td>
	      	<td>{{v.nome_paciente}}</td>
	      	<td>{{v.idade_paciente}}</td>
	      	<td>{{v.sexo_paciente}}</td>
	      	<td>
	      		{% if v.regulacao_paciente == 'Paciente preenche criterios para Regulação' %}
	      		Regulado
	      		{%else%}
	      		Nao Regulado
	      		{%endif%}
	      	</td>
	      	<td>{{v.cidade_origem}}</td>        
	      </tr>
	      	{% endfor %}
	      
	    </tbody>
  	</table>
  	<br />
  	<div class="container-fluid" style="text-align: center;">
  		<button autofocus="autofocus" class="btn btn-warning" style="align-items: center;" id="" onclick="exceller()">Export to Excel</button>  
	</div><br />

  <div style="height: 50px"></div>

		
	</div><br />

	
	<div style="background-color: #e6e6e6;">
		
			<br /><br />
		
	</div>

	<script>
		function exceller() {
			var uri = 'data:application/vnd.ms-excel;base64,',
	      template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
	      base64 = function(s) {
	        return window.btoa(unescape(encodeURIComponent(s)))
	      },
	      format = function(s, c) {
	        return s.replace(/{(\w+)}/g, function(m, p) {
	          return c[p];
	        })
	      }
	    var tb_covid1 = document.getElementById("tb_covid1").innerHTML;
	    var ctx = {
	      worksheet: name || '',
	      table: tb_covid1
	    };
	    var link = document.createElement("a");
	    link.download = "export.xls";
	    link.href = uri + base64(format(template, ctx))
	    link.click();
	  }
	</script>
	
</body>
</html>